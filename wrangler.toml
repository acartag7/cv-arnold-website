# Cloudflare Workers configuration for CV Arnold Website
# https://developers.cloudflare.com/workers/configuration/

name = "cv-arnold-website"
main = "src/index.ts"
compatibility_date = "2025-01-19"
compatibility_flags = ["nodejs_compat"]

# Workers Site configuration (for static assets)
[site]
bucket = "./out"  # Next.js static export output directory

# KV Namespace Bindings
#
# TO CREATE THE NAMESPACE (choose one method):
#
# Method 1 - Wrangler CLI (in your terminal, not Claude Code):
#   npx wrangler login
#   npx wrangler kv namespace create CV_DATA
#   # Copy the ID from output
#
# Method 2 - Cloudflare Dashboard:
#   1. Go to Cloudflare dashboard → Workers & Pages → KV
#   2. Click "Create namespace" → Name it "CV_DATA"
#   3. Copy the namespace ID from the list
#
# Then replace "YOUR_KV_NAMESPACE_ID" below with the actual ID
#
# For local development, Miniflare will automatically emulate KV (no setup needed)

[[kv_namespaces]]
binding = "CV_DATA"
id = "c9df8a4271984ad8bb0a02c30ff3568d"

[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "30a87d8776c04d54a423fdd4e84cba5f"

[[kv_namespaces]]
binding = "CV_HISTORY"
id = "0c0ada9ed85a427fb87b97bd5761e407"

# R2 Bucket for images and backups
# Free tier: 10GB storage, 1M writes/month, 10M reads/month
[[r2_buckets]]
binding = "CV_ASSETS"
bucket_name = "cv-assets"

# Build configuration
[build]
command = "pnpm build"
cwd = "."
watch_dirs = ["src"]

# Observability (available on all plans)
[observability]
enabled = true
