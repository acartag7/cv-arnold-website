# Cloudflare Workers Configuration - API Worker
# https://developers.cloudflare.com/workers/configuration/
#
# Enterprise Architecture:
# - Production: api.arnoldcartagena.com (cv-arnold-api)
# - Dev: api-dev.arnoldcartagena.com (cv-arnold-api-dev)
#
# Deploy commands:
#   Production: wrangler deploy
#   Dev: wrangler deploy --env dev

name = "cv-arnold-api"
main = "src/index.ts"
compatibility_date = "2025-01-19"
compatibility_flags = ["nodejs_compat"]

# =============================================================================
# Production KV Namespaces
# =============================================================================

[[kv_namespaces]]
binding = "CV_DATA"
id = "c9df8a4271984ad8bb0a02c30ff3568d"

[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "30a87d8776c04d54a423fdd4e84cba5f"

[[kv_namespaces]]
binding = "CV_HISTORY"
id = "0c0ada9ed85a427fb87b97bd5761e407"

# =============================================================================
# R2 Bucket (shared between environments)
# =============================================================================

[[r2_buckets]]
binding = "CV_ASSETS"
bucket_name = "cv-assets"

# =============================================================================
# Production Environment Variables
# =============================================================================

[vars]
ENVIRONMENT = "production"
ALLOWED_ORIGINS = "https://cv.arnoldcartagena.com,https://api.arnoldcartagena.com,http://localhost:3000"

# =============================================================================
# Observability
# =============================================================================

[observability]
enabled = true

# =============================================================================
# Dev Environment
# =============================================================================

[env.dev]
name = "cv-arnold-api-dev"

# Dev KV Namespaces (isolated from production)
# Note: IDs will be populated after Terraform apply creates the namespaces
# Run: terraform output kv_namespace_ids_dev
[[env.dev.kv_namespaces]]
binding = "CV_DATA"
id = "CV_DATA_DEV_ID_PLACEHOLDER"

[[env.dev.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "RATE_LIMIT_KV_DEV_ID_PLACEHOLDER"

[[env.dev.kv_namespaces]]
binding = "CV_HISTORY"
id = "CV_HISTORY_DEV_ID_PLACEHOLDER"

# Dev R2 Bucket (same bucket, different prefix could be used)
[[env.dev.r2_buckets]]
binding = "CV_ASSETS"
bucket_name = "cv-assets"

# Dev Environment Variables
[env.dev.vars]
ENVIRONMENT = "dev"
ALLOWED_ORIGINS = "https://dev-cv.arnoldcartagena.com,https://api-dev.arnoldcartagena.com,http://localhost:3000"
