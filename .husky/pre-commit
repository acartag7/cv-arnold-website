#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run lint-staged for staged files
echo "🧹 Running lint-staged..."
pnpm exec lint-staged

# Check if any TypeScript/JavaScript files are staged
TS_JS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

if [ -n "$TS_JS_FILES" ]; then
  # Run TypeScript type checking only if TS/JS files changed
  echo "🔍 Running TypeScript type check..."
  pnpm exec tsc --noEmit
  
  # Run build to ensure everything compiles
  echo "🏗️  Running build check..."
  pnpm run build
else
  echo "📝 Only non-TypeScript files changed, skipping type check and build"
fi

echo "✅ Pre-commit checks passed!"
